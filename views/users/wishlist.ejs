<%- include("../../views/partials/user/header") %>

<!-- Include Flat UI CSS and Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flat-ui/2.3.0/css/flat-ui.min.css" 
    integrity="sha512-6f7HT84a/AplPkpSRSKWqbseRTG4aRrhadjZezYQ0oVk/B+nm/US5KzQkyyOyh0Mn9cyDdChRdS9qaxJRHayww==" 
    crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

<style>
 .mt-10.mb-50 {
  padding: 40px 0;
  background-color: #f8f9fa;
}

.container {
  max-width: 1200px;
  margin: 0 auto;
}

/* Table styling */
.shopping-summery {
  width: 100%;
  background-color: #ffffff;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  overflow: hidden;
  border: none !important;
}

.shopping-summery thead {
  background-color: #f0f2f5;
}

.shopping-summery th {
  padding: 15px 10px;
  font-weight: 600;
  color: #333;
  text-transform: uppercase;
  font-size: 14px;
  letter-spacing: 0.5px;
  border: none !important;
  border-bottom: 1px solid #e6e6e6 !important;
}

.shopping-summery td {
  padding: 15px 10px;
  vertical-align: middle;
  border: none !important;
  border-bottom: 1px solid #f0f0f0 !important;
}

/* Product image styling */
.product-thumbnail img {
  width: 80px;
  height: 80px;
  object-fit: cover;
  border-radius: 6px;
  transition: transform 0.3s ease;
}

.product-thumbnail img:hover {
  transform: scale(1.05);
}

/* Product name styling */
.product-name a {
  color: #333;
  font-weight: 600;
  font-size: 15px;
  text-decoration: none;
  transition: color 0.2s ease;
}

.product-name a:hover {
  color: #4a6cf7;
}

.font-xxs {
  font-size: 12px;
  color: #888;
  margin-top: 5px;
}

/* Price styling */
.price span {
  font-weight: 600;
  color: #333;
  font-size: 16px;
}

/* Button styling */
.btn-sm {
  padding: 8px 15px;
  background-color: #08a183;
  border: none;
  color: white;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  text-decoration: none;
  transition: background-color 0.2s ease;
  display: inline-block;
}

.btn-sm:hover {
  background-color: #35d1d1;
  text-decoration: none;
  color: white;
}

.action .btn-sm {
  background-color: #ff6b6b;
}

.action .btn-sm:hover {
  background-color: #e55252;
}

.action .btn-sm i {
  font-size: 14px;
}

/* Empty wishlist styling */
.text-center .lead {
  padding: 30px 0;
  color: #888;
}

/* Pagination styling */
.pagination {
  display: flex;
  justify-content: center;
  gap: 5px;
  margin-top: 30px;
  padding: 15px 0;
}

.pagination .btn {
  padding: 8px 15px;
  background-color: #f0f2f5;
  border: 1px solid #e6e6e6;
  color: #333;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  text-decoration: none;
  transition: all 0.2s ease;
}

.pagination .btn:hover {
  background-color: #e6e6e6;
}

.pagination .btn.active {
  background-color: #08b59e;
  color: white;
  border-color: #0ccdb6;
}

/* Responsive styling */
@media (max-width: 768px) {
  .shopping-summery {
    font-size: 13px;
  }
  
  .product-thumbnail img {
    width: 60px;
    height: 60px;
  }
  
  .btn-sm {
    padding: 6px 10px;
    font-size: 12px;
  }
}

@media (max-width: 576px) {
  .shopping-summery thead {
    display: none;
  }
  
  .shopping-summery, 
  .shopping-summery tbody, 
  .shopping-summery tr, 
  .shopping-summery td {
    display: block;
    width: 100%;
    text-align: left;
  }
  
  .shopping-summery tr {
    margin-bottom: 20px;
    border: 1px solid #e6e6e6;
    border-radius: 8px;
    overflow: hidden;
  }
  
  .shopping-summery td {
    position: relative;
    padding-left: 120px;
  }
  
  .shopping-summery td:before {
    content: attr(data-title);
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-weight: 600;
    color: #333;
  }
  
  .product-thumbnail img {
    width: 80px;
    height: 80px;
  }
}
.page-header.breadcrumb-wrap {
    margin-top: 10px;
    background-color: #ede9ec;
    padding: 10px 0;
}

.breadcrumb-wrap {
    padding: 15px 0;
    background-color: #1e918b;
    color: #fff;
}

.breadcrumb a {
    color: #088178;
    text-decoration: none;
}

.breadcrumb span {
    margin: 0 5px;
    color: rgb(125, 124, 124);
}
.table-shopping-summery {
    width: 100%;
    border-collapse: collapse;
}

.table-shopping-summery th,
.table-shopping-summery td {
    font-size: 10px;
    padding: 10px;
    text-align: center;
}

.table-shopping-summery .product-thumbnail img {
    max-width: 50px;
    height: auto;
}

.table-shopping-summery .price span {
    font-weight: bold;
}

.table-shopping-summery .btn {
    padding: 8px 16px;
    font-size: 12px;
    text-transform: uppercase;
    cursor: pointer;
}

.table-shopping-summery .btn-sm {
    padding: 6px 12px;
}

.table-shopping-summery .btn {
    background-color: #1e918b;
    color: #fff;
    border: none;
}

.table-shopping-summery .btn:hover {
    background-color: #18877c;
}

.table-shopping-summery .fi-rs-trash {
    font-size: 18px;
    color: #d33;
}

.pagination {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin: 20px 0;
}

.pagination a {
  padding: 8px 12px;
  background: #fff;
  color: #333;
  text-decoration: none;
  border: 1px solid #ccc;
  border-radius: 4px;
  transition: background-color 0.3s ease, transform 0.2s;
}

.pagination a:hover {
  background-color: #1e918b;
  color: white;
  transform: scale(1.05);
}

.pagination .active {
  background-color: #1e918b;
  color: white;
}
</style>

<main class="main">
   <div class="page-header breadcrumb-wrap">
       <div class="container">
           <div class="breadcrumb">
               <a href="/" rel="nofollow">Home</a>
               <span></span><a href="/shop" rel="nofollow">Shop</a>
               <span></span> My Wishlist
           </div>
       </div>
   </div>

   <section class="mt-10 mb-50">
       <div class="container">
           <div class="row">
               <div class="col-12 products">
                   <div class="table-responsive">
                       <table class="table shopping-summery text-center clean" style="font-size: 15px; border: 1px solid #e6e1e1;
                            border-collapse: collapse;">
                           <thead style="border: 1px solid #e6e1e1;">
                               <tr class="main-heading" style="border: 1px solid #e6e1e1;">
                                   <th scope="col" style="border: 1px solid #e6e1e1;">Sl. No</th>
                                   <th scope="col" style="border: 1px solid #e6e1e1;">Image</th>
                                   <th scope="col" style="border: 1px solid #e6e1e1;">Name</th>
                                   <th scope="col" style="border: 1px solid #e6e1e1;">Price</th>
                                   <th scope="col" style="border: 1px solid #e6e1e1;">Add to Cart</th>
                                   <th scope="col" style="border: 1px solid #e6e1e1;">Remove</th>
                               </tr>
                           </thead>
                           <tbody style="font-size: 12px; border: 1px solid #e6e1e1;">
                             <% if(wishlist.length > 0){ %>
                               <% wishlist.forEach((product, index) => { %>
                                       <tr id="wishlist-item-<%= product._id %>">
                                           <td style="border: 1px solid #e6e1e1;" class="py-5"><%= index + 1 %></td>
                                           <td class="image product-thumbnail" style="border: 1px solid #e6e1e1;">
                                               <img src="http://localhost:3000/<%= product.productImage[0]%>" />
                                           </td>
                                           <td class="product-des product-name py-4" style="border: 1px solid #e6e1e1; ">
                                               <p class="product-name">
                                                   <a href="">
                                                      <%= product.productName %>
                                                   </a>
                                                </p>
                                               <p class="font-xxs">
                                                <%= product.category.name %> <br/>
                                                <% if (product.brand && product.brand.brandName) { %>
                                                    <span> Brand: <%= product.brand.brandName %> </span>
                                                <% } %>
                                            
                                            </p>
                                           </td>
                                           <td class="price py-5" data-title="Price" style="border: 1px solid #e6e1e1;">â‚¹<span>
                                             <%= product.salePrice %>
                                           </span></td>
                                           <td class="text-center py-5 px-4" data-title="Add to Cart" style="border: 1px solid #e6e1e1; width:100px">
                                               <a href="#" onclick="addToCart('<%= product._id %>')" class="btn btn-sm">Add to Cart</a>
                                           </td>
                                           <td class="action py-5" data-title="Remove" style="border: 1px solid #e6e1e1;">
                                               <a class="btn btn-sm" href="#" onclick="confirmRemove('<%= product._id %>')">
                                                   <i class="fi-rs-trash"></i>
                                               </a>
                                           </td>
                                       </tr>
                                       <% }) %>
                                       <%} else {%>
                                   <tr>
                                        <td colspan="5" class="text-center">
                                           <p class="lead mb-4">No items found in the Wishlist</p>
                                       </td>
                                   </tr>
                                   <%}%>
                           </tbody>
                       </table>
                   </div>
               </div>
           </div>
       </div>
       <div class="pagination" style="background: #fff;">
        <% if (currentPage > 1) { %>
            <a class="btn" href="/wishlist?page=<%= currentPage - 1 %>">Prev</a>
        <% } %>
        
        <% for (let i = 1; i <= totalPages; i++) { %>
            
            <a class="btn <%= currentPage === i ? 'active' : '' %>" href="/wishlist?page=<%= i %>"><%= i %></a>
            
        <% } %>
        
        <% if (currentPage < totalPages) { %>
            <a class="btn" href="/wishlist?page=<%= currentPage + 1 %>">Next</a>
        <% } %>
      </div>
   </section>
</main>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function addToCart(productId) {
   $.ajax({
      url: '/addToCart',
      method: 'POST',
      data: { productId: productId },
      success: (response) => {
         console.log("response is", response);
         if (response.status) {
            Swal.fire({
               title: 'Added to Cart',
               text: response.message || 'The product has been added to your cart.',
               icon: 'success',
               timer: 2000,
               showCancelButton: true,
               confirmButtonText: 'Go to Cart',
               cancelButtonText: 'Okay!',
               customClass: {
                  popup: 'swal-popup-custom',
               }
            }).then((result) => {
               if (result.isConfirmed) {
                  window.location.href = '/cart';
               }
            });
         } else {
            Swal.fire({
               title: 'Already in Cart',
               text: response.message || 'This product is already in your cart.',
               icon: 'info',
               timer: 2000,
               customClass: {
                  popup: 'swal-popup-custom',  // Custom class for popup
               }
            });
         }
      },
      error: (error) => {
         Swal.fire({
            title: 'Error',
            text: 'There was an error adding cart',
            icon: 'error',
            timer: 2000,
            customClass: {
               popup: 'swal-popup-custom',  // Custom class for popup
            }
         });
      }
   });
}
    
    function confirmRemove(productId) {
    Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, remove it!'
    }).then((result) => {
        if (result.isConfirmed) {
            fetch(`/removeFromWishlist?productId=${productId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    Swal.fire('Error', data.error, 'error');
                } else {
                    // Remove item from the UI
                    const wishlistItem = document.getElementById(`wishlist-item-${productId}`);
                    if (wishlistItem) {
                        wishlistItem.remove();
                    }

                    // Check if wishlist is empty
                    const wishlistTableBody = document.querySelector("tbody");
                    if (!wishlistTableBody.querySelector("tr[id^='wishlist-item-']")) {
                        wishlistTableBody.innerHTML = `
                            <tr>
                                <td colspan="5" class="text-center">
                                    <p class="lead mb-4">No item found in the Wishlist</p>
                                </td>
                            </tr>`;
                    }

                    Swal.fire('Deleted!', 'Product removed from Wishlist.', 'success');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire('Error', 'Failed to remove product.', 'error');
            });
        }
    });
}


</script>
<%- include("../../views/partials/user/footer") %>

